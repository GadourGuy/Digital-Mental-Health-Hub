<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mood Tracker</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Arimo:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link rel="stylesheet" th:href="@{/css/student/mood-tracker.css}" />
    <link rel="stylesheet" th:href="@{/css/student/student_nav.css}" />
</head>
<body>

<div class="dashboard-container">
    
    <div th:replace="fragments/Student-navbar :: navbar(activeTab='mood')"></div>

    <main class="main-content">
        
        <div class="page-header">
            <div class="page-title">Mood Tracker</div>
            <div class="page-subtitle">Track your emotional wellness over time</div>
        </div>

        <div class="card">
            <div class="card-title">How are you feeling today?</div>
            <div class="card-desc">Select your current mood and add optional notes</div>

            <form th:action="@{/student/mood-tracker/save}" method="POST" id="moodForm">
                <input type="hidden" name="mood" id="selectedMoodInput" required>
                <input type="hidden" name="score" id="selectedScoreInput" required>

                <div class="mood-options">
                    <div class="mood-btn" onclick="selectMood(this, 'Excellent', 5)">
                        <div class="mood-icon"><i class="fa-solid fa-face-laugh-beam"></i></div>
                        <div class="mood-label">Excellent</div>
                    </div>
                    <div class="mood-btn" onclick="selectMood(this, 'Good', 4)">
                        <div class="mood-icon"><i class="fa-solid fa-face-smile"></i></div>
                        <div class="mood-label">Good</div>
                    </div>
                    <div class="mood-btn" onclick="selectMood(this, 'Okay', 3)">
                        <div class="mood-icon"><i class="fa-solid fa-face-meh"></i></div>
                        <div class="mood-label">Okay</div>
                    </div>
                    <div class="mood-btn" onclick="selectMood(this, 'Not Great', 2)">
                        <div class="mood-icon"><i class="fa-solid fa-face-frown-open"></i></div>
                        <div class="mood-label">Not Great</div>
                    </div>
                    <div class="mood-btn" onclick="selectMood(this, 'Bad', 1)">
                        <div class="mood-icon"><i class="fa-solid fa-face-dizzy"></i></div>
                        <div class="mood-label">Bad</div>
                    </div>
                </div>

                <label style="font-size:14px; font-weight:bold; display:block; margin-bottom:8px;">Add a note (optional)</label>
                <textarea name="note" class="note-input" rows="2" placeholder="What's on your mind? Any thoughts about your day..."></textarea>
                
                <button type="submit" class="save-btn">Save Mood Entry</button>
            </form>
        </div>

        <div class="card">
            <div class="card-title">Mood Analytics</div>
            <div class="card-desc">Visualize your emotional patterns</div>
            
            <div class="stats-badge">
                <div class="stats-label">This Week</div>
                <div class="stats-value">Weekly Average: <span th:text="${weeklyAverage}">0.0</span>/5</div>
            </div>

            <div style="height: 300px; width: 100%;">
                <canvas id="moodChart"></canvas>
            </div>
        </div>

        <div class="card">
            <div class="card-title">Recent Entries</div>
            <div class="card-desc">Your mood journal history</div>

            <div class="entry-list">
                <div class="entry-item" th:each="entry : ${moodList}">
                    <div class="entry-icon-box" 
                         th:style="${entry.score >= 4} ? 'background: #DBEAFE; color: #155DFC' : 
                                   (${entry.score == 3} ? 'background: #FEF9C2; color: #F0B100' : 'background: #FEE2E2; color: #E7000B')">
                        <i th:if="${entry.score >= 4}" class="fa-solid fa-face-smile"></i>
                        <i th:if="${entry.score == 3}" class="fa-solid fa-face-meh"></i>
                        <i th:if="${entry.score <= 2}" class="fa-solid fa-face-frown"></i>
                    </div>
                    <div class="entry-content">
                        <div class="entry-top">
                            <div class="entry-date" th:text="${#temporals.format(entry.date, 'MMM d, yyyy HH:mm')}">Nov 7, 2025</div>
                            <div class="entry-mood" th:text="${entry.mood}">Good</div>
                        </div>
                        <div class="entry-note" th:text="${entry.note}">Note content...</div>
                    </div>
                </div>
                
                <div th:if="${#lists.isEmpty(moodList)}" style="text-align:center; padding: 20px; color: #666;">
                    No mood entries yet. Log how you feel above!
                </div>
            </div>
        </div>

    </main>
</div>

<script th:inline="javascript">
    // 1. Mood Selection Logic
    function selectMood(element, moodText, scoreVal) {
        // Remove 'selected' class from all buttons
        document.querySelectorAll('.mood-btn').forEach(btn => btn.classList.remove('selected'));
        // Add 'selected' class to clicked button
        element.classList.add('selected');
        // Set hidden inputs
        document.getElementById('selectedMoodInput').value = moodText;
        document.getElementById('selectedScoreInput').value = scoreVal;
    }

    // 2. Chart.js Logic
    var scores = [[${graphScores}]];
    var dates = [[${graphDates}]];

    const ctx = document.getElementById('moodChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: dates,
            datasets: [{
                label: 'Mood Score',
                data: scores,
                borderColor: '#155DFC',
                backgroundColor: 'rgba(21, 93, 252, 0.1)',
                borderWidth: 3,
                tension: 0.4,
                fill: true,
                pointBackgroundColor: '#155DFC',
                pointRadius: 5
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    min: 0,
                    max: 5.5,
                    ticks: {
                        stepSize: 1,
                        callback: function(value) {
                            if(value == 1) return 'Bad';
                            if(value == 2) return 'Not Great';
                            if(value == 3) return 'Okay';
                            if(value == 4) return 'Good';
                            if(value == 5) return 'Excellent';
                            return '';
                        }
                    },
                    grid: { borderDash: [5, 5] }
                },
                x: {
                    grid: { display: false }
                }
            },
            plugins: {
                legend: { display: false }
            }
        }
    });
</script>

</body>
</html>